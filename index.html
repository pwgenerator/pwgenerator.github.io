<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>G√©n√©rateur de mot de passe</title>
  <meta name="description" content="G√©n√©rateur de mots de passe fort, 100% c√¥t√© client. Aucune donn√©e n‚Äôest envoy√©e sur un serveur." />
  <style>
    :root{
      --bg:#0b0f14;--panel:#10161d;--panel-2:#111922;--text:#e7edf3;--muted:#a7b4c1;--accent:#4ea1ff;--accent-2:#6bffb5;--danger:#ff6b6b;--shadow:0 10px 30px rgba(0,0,0,.35);--radius:18px
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:radial-gradient(1200px 600px at 20% -10%,rgba(78,161,255,.15),transparent 60%),radial-gradient(800px 600px at 120% 20%,rgba(107,255,181,.08),transparent 50%),var(--bg);color:var(--text);font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Inter,Ubuntu,"Helvetica Neue",Arial}
    .wrap{max-width:950px;margin:40px auto;padding:24px}
    header{display:flex;gap:14px;align-items:center;justify-content:space-between;margin-bottom:18px}
    h1{font-size:clamp(1.2rem,3vw,1.6rem);margin:0}
    .badge{font-size:.8rem;padding:.35rem .6rem;background:linear-gradient(135deg,var(--panel-2),#0b1218);border:1px solid #1b2430;border-radius:999px;color:var(--muted)}
    .card{background:linear-gradient(180deg,var(--panel),var(--panel-2));border:1px solid #1a2330;border-radius:var(--radius);box-shadow:var(--shadow);padding:22px}
    .stack{display:grid;gap:16px}
    .row{display:flex;gap:14px;align-items:center;flex-wrap:wrap}
    .grow{flex:1}
    input[type="text"], input[readonly]{width:100%;padding:14px 16px;border-radius:14px;border:1px solid #1c2533;background:#0b1218;color:var(--text);font-size:1.05rem}
    .btn{appearance:none;border:1px solid #243245;background:linear-gradient(180deg,#15202B,#0f1721);color:var(--text);padding:12px 16px;border-radius:14px;cursor:pointer;box-shadow:var(--shadow);font-weight:600}
    .btn:hover{filter:brightness(1.08)}
    .btn:active{transform:translateY(1px)}
    .btn.primary{background:linear-gradient(180deg,#1a66ff,#1246b8);border-color:#1a66ff}
    .btn.ghost{background:transparent;border-color:#203147}
    label{display:flex;align-items:center;gap:10px;color:var(--muted)}
    input[type="range"]{width:100%}
    .options{display:grid;grid-template-columns:repeat(auto-fit,minmax(230px,1fr));gap:12px}
    .meter{height:12px;background:#0b1218;border:1px solid #1b2634;border-radius:999px;position:relative;overflow:hidden}
    .meter > span{position:absolute;left:0;top:0;bottom:0;width:0%;transition:width .25s ease}
    .seg{position:absolute;inset:0;display:grid;grid-template-columns:repeat(4,1fr);gap:4px;padding:2px}
    .seg i{border-radius:999px;background:#13202c}
    .note{font-size:.9rem;color:var(--muted)}
    .tiny{font-size:.8rem;color:var(--muted)}
    .footer{margin-top:18px;color:#8fa0b3;font-size:.85rem;display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap}
    .switch{position:relative;width:44px;height:26px;background:#0b1218;border:1px solid #203147;border-radius:999px;cursor:pointer}
    .switch input{display:none}
    .switch .knob{position:absolute;top:2px;left:2px;width:22px;height:22px;border-radius:50%;background:#233449;transition:left .2s ease, background .2s}
    .switch input:checked + .knob{left:20px;background:var(--accent)}
    kbd{background:#0b1218;border:1px solid #203147;border-bottom-width:3px;border-radius:6px;padding:2px 6px;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;color:#d7e3ef}
    a{color:var(--accent)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>üîê G√©n√©rateur de mot de passe</h1>
      <span class="badge">100% local ¬∑ open-source</span>
    </header>

    <div class="card stack" role="region" aria-labelledby="titre-gen">
      <div class="row">
        <input id="output" type="text" aria-label="Mot de passe g√©n√©r√©" readonly>
        <button id="copy" class="btn" title="Copier" aria-label="Copier dans le presse-papiers">Copier</button>
        <button id="regen" class="btn primary" title="R√©g√©n√©rer" aria-label="G√©n√©rer un nouveau mot de passe">R√©g√©n√©rer</button>
      </div>

      <div class="row">
        <div class="grow">
          <label for="length">Longueur : <strong id="lenVal">16</strong></label>
          <input id="length" type="range" min="8" max="128" value="16" step="1" />
        </div>
        <label class="row"><input id="excludeAmbig" type="checkbox" /><span>Exclure les caract√®res ambigus (O/0, l/1, etc.)</span></label>
      </div>

      <div class="options">
        <label><input id="lower" type="checkbox" checked /> Lettres minuscules (a‚Äìz)</label>
        <label><input id="upper" type="checkbox" checked /> Lettres majuscules (A‚ÄìZ)</label>
        <label><input id="digits" type="checkbox" checked /> Chiffres (0‚Äì9)</label>
        <label><input id="symbols" type="checkbox" /> Symboles (!@#$‚Ä¶)</label>
        <label><input id="noRepeat" type="checkbox" /> Interdire les doublons</label>
        <label class="row">Exclure : <input id="excludeChars" type="text" placeholder="caract√®res √† exclure (ex: %*^‚Ç¨)" /></label>
      </div>

      <div class="stack">
        <div class="row" aria-live="polite" aria-atomic="true">
          <div class="meter grow" title="Indice de robustesse">
            <div class="seg"><i></i><i></i><i></i><i></i></div>
            <span id="meterFill"></span>
          </div>
          <div id="strengthLabel" class="badge" style="white-space:nowrap">Entropie¬†: 0 bits</div>
        </div>
        <div class="tiny">Astuce¬†: utilisez au moins 16 caract√®res. √âvitez les phrases courantes. Pour des comptes critiques, activez l‚Äôauthentification √† deux facteurs.</div>
      </div>
    </div>

    <div class="footer">
      <div>
        <strong>Confidentialit√© :</strong> tout est g√©n√©r√© dans votre navigateur (<code>window.crypto</code>). Rien n‚Äôest envoy√© nulle part.
      </div>
      <div>
        <label class="switch" title="Toggle th√®me">
          <input id="theme" type="checkbox" />
          <span class="knob"></span>
        </label>
      </div>
    </div>

  </div>

<script>
(function(){
  'use strict';
  // Character sets
  const LOWER = 'abcdefghijklmnopqrstuvwxyz';
  const UPPER = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
  const DIGITS = '0123456789';
  const SYMBOLS = '!@#$%^&*()-_=+[]{};:,.?/\\|`~\"\' + "'¬´¬ª‚Äπ‚Ä∫‚Äú‚Äù‚Äô‚Ç¨¬£¬•‚Ä¶¬∑‚Ä¢"; // include some EU symbols
  const AMBIG = new Set('Il1O0oB8S5Z2\u00B5');

  // UI elements
  const $ = id => document.getElementById(id);
  const output = $('output');
  const copyBtn = $('copy');
  const regenBtn = $('regen');
  const lengthEl = $('length');
  const lenVal = $('lenVal');
  const eLower = $('lower');
  const eUpper = $('upper');
  const eDigits = $('digits');
  const eSymbols = $('symbols');
  const eNoRepeat = $('noRepeat');
  const eExcludeAmbig = $('excludeAmbig');
  const eExcludeChars = $('excludeChars');
  const meterFill = $('meterFill');
  const strengthLabel = $('strengthLabel');
  const theme = $('theme');

  // Helper: cryptographically secure random integer in [0, max)
  function rnd(max){
    if(max <= 0) return 0;
    const arr = new Uint32Array(1);
    let limit = Math.floor(0x100000000 / max) * max; // rejection sampling to avoid bias
    do { crypto.getRandomValues(arr); } while(arr[0] >= limit);
    return arr[0] % max;
  }

  function buildPool(){
    let pool = '';
    if(eLower.checked) pool += LOWER;
    if(eUpper.checked) pool += UPPER;
    if(eDigits.checked) pool += DIGITS;
    if(eSymbols.checked) pool += SYMBOLS;
    // Remove excluded & ambiguous
    const exclude = new Set((eExcludeChars.value || '').split(''));
    let filtered = '';
    for(const ch of pool){
      if(eExcludeAmbig.checked && AMBIG.has(ch)) continue;
      if(exclude.has(ch)) continue;
      filtered += ch;
    }
    return Array.from(new Set(filtered.split(''))).join(''); // de-dup in case
  }

  function generate(){
    const length = parseInt(lengthEl.value,10);
    let pool = buildPool();
    if(pool.length === 0){
      output.value = '';
      updateStrength(0, 0);
      return;
    }

    // Ensure at least one from each selected set
    const required = [];
    if(eLower.checked) required.push(LOWER);
    if(eUpper.checked) required.push(UPPER);
    if(eDigits.checked) required.push(DIGITS);
    if(eSymbols.checked) required.push(SYMBOLS);

    // Filter required chars according to exclusions
    const reqChars = [];
    for(const set of required){
      const candidates = set.split('').filter(ch => buildPool().includes(ch));
      if(candidates.length){
        reqChars.push(candidates[rnd(candidates.length)]);
      }
    }

    let pwd = [];
    const used = new Set();

    // Place required characters first
    for(const ch of reqChars){
      pwd.push(ch);
      if(eNoRepeat.checked) used.add(ch);
    }

    // Fill remaining positions
    while(pwd.length < length){
      let ch = pool[rnd(pool.length)];
      if(eNoRepeat.checked && used.has(ch)) continue;
      pwd.push(ch);
      if(eNoRepeat.checked) used.add(ch);
      if(used.size >= pool.length && eNoRepeat.checked) break; // cannot add more unique chars
    }

    // If we could not reach desired length due to noRepeat, warn softly
    if(pwd.length < length && eNoRepeat.checked){
      // do nothing visually obtrusive; length is best-effort
    }

    // Shuffle (Fisher‚ÄìYates)
    for(let i = pwd.length - 1; i > 0; i--){
      const j = rnd(i + 1); [pwd[i], pwd[j]] = [pwd[j], pwd[i]];
    }

    const result = pwd.join('');
    output.value = result;
    updateStrength(result.length, pool.length);
  }

  function updateStrength(len, poolSize){
    const bits = (poolSize > 0 && len > 0) ? (len * Math.log2(poolSize)) : 0;
    const pct = Math.max(0, Math.min(100, Math.round((bits / 128) * 100))); // 128 bits ~ excellent
    meterFill.style.width = pct + '%';
    let label = 'Faible';
    if(bits >= 64 && bits < 90) label = 'Correct';
    else if(bits >= 90 && bits < 128) label = 'Fort';
    else if(bits >= 128) label = 'Excellent';
    strengthLabel.textContent = `Entropie: ${bits.toFixed(1)} bits ‚Ä¢ ${label}`;
    meterFill.style.background = bits>=128? 'linear-gradient(90deg,#4caf50,#6bffb5)': bits>=90? 'linear-gradient(90deg,#8bc34a,#4caf50)': bits>=64? 'linear-gradient(90deg,#ffc107,#8bc34a)': 'linear-gradient(90deg,#ff6b6b,#ff8a80)';
  }

  function copy(){
    const val = output.value;
    if(!val) return;
    navigator.clipboard.writeText(val).then(()=>{
      copyBtn.textContent = 'Copi√© !';
      setTimeout(()=> copyBtn.textContent = 'Copier', 1400);
    }).catch(()=>{
      output.select(); document.execCommand('copy');
      copyBtn.textContent = 'Copi√© !';
      setTimeout(()=> copyBtn.textContent = 'Copier', 1400);
    });
  }

  function saveSettings(){
    const data = {
      length: lengthEl.value, lower: eLower.checked, upper: eUpper.checked,
      digits: eDigits.checked, symbols: eSymbols.checked, noRepeat: eNoRepeat.checked,
      excludeAmbig: eExcludeAmbig.checked, excludeChars: eExcludeChars.value
    };
    try{ localStorage.setItem('pwgen-settings', JSON.stringify(data)); }catch(e){}
  }
  function loadSettings(){
    try{
      const raw = localStorage.getItem('pwgen-settings');
      if(!raw) return; const d = JSON.parse(raw);
      lengthEl.value = d.length ?? 16; lenVal.textContent = lengthEl.value;
      eLower.checked = !!d.lower; eUpper.checked = !!d.upper; eDigits.checked = !!d.digits; eSymbols.checked = !!d.symbols;
      eNoRepeat.checked = !!d.noRepeat; eExcludeAmbig.checked = !!d.excludeAmbig; eExcludeChars.value = d.excludeChars || '';
    }catch(e){}
  }

  function toggleTheme(){
    const dark = document.documentElement.classList.toggle('light');
  }

  // Bindings
  lengthEl.addEventListener('input', ()=>{ lenVal.textContent = lengthEl.value; generate(); saveSettings(); });
  [eLower,eUpper,eDigits,eSymbols,eNoRepeat,eExcludeAmbig].forEach(el=> el.addEventListener('change', ()=>{ generate(); saveSettings(); }));
  eExcludeChars.addEventListener('input', ()=>{ generate(); saveSettings(); });
  copyBtn.addEventListener('click', copy);
  regenBtn.addEventListener('click', generate);
  theme.addEventListener('change', toggleTheme);

  // Init
  loadSettings();
  generate();
})();
</script>
</body>
</html>
