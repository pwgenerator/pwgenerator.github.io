<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Générateur de mot de passe</title>
  <meta name="description" content="Générateur de mots de passe sécurisé (crypto) – fonctionne hors-ligne, aucune donnée envoyée." />

  <!-- Lien vers la politique de confidentialité -->
  <link rel="privacy-policy" href="/privacy.html" />

  <!-- Google Consent Mode v2 (par défaut: denied ; ta CMP mettra à jour) -->
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('consent', 'default', {
      'ad_storage': 'denied',
      'analytics_storage': 'denied',
      'ad_user_data': 'denied',
      'ad_personalization': 'denied',
      'wait_for_update': 500
    });
  </script>

  <!-- Auto ads AdSense (REMPLACE client par ton ID ca-pub-XXXXXXXXXXXX) -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2997467743646399" crossorigin="anonymous"></script>

  <style>
    :root{
      --bg:#0f1221; --card:#171a2b; --text:#e6e9f5; --muted:#a7acc6; --accent:#7c96ff; --accent-2:#41e8c1; --danger:#ff5d7a;
      --border:#2a2e46; --radius:14px; --radius-sm:10px; --focus:0 0 0 3px rgba(124,150,255,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial;
      color:var(--text); background: radial-gradient(1200px 800px at 10% -10%, #1b1f39 0, #0f1221 40%, #0b0e1a 100%);
      display:flex; align-items:center; justify-content:center; padding:32px;
    }
    .app{width: min(900px, 96vw); display:grid; gap:18px}
    header h1{margin:0 0 6px 0; font-weight:800; letter-spacing:.2px}
    header p{margin:0; color:var(--muted)}
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.03), transparent), var(--card);
      border:1px solid var(--border); border-radius:var(--radius); padding:18px;
      box-shadow: 0 20px 60px rgba(0,0,0,.35);
    }
    .row{display:grid; grid-template-columns: 1fr auto; gap:10px; align-items:center}
    .out{
      font: 600 20px/1.2 ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      background:#0b0e1a; border:1px solid var(--border); border-radius:var(--radius-sm);
      padding:14px; overflow:auto; white-space:nowrap;
    }
    .btn{
      border:1px solid var(--border); background:linear-gradient(180deg, #2a325a, #20274a);
      color:#fff; padding:12px 16px; border-radius:12px; cursor:pointer; font-weight:700; letter-spacing:.2px;
      transition: transform .04s ease, box-shadow .2s ease, background .2s ease;
    }
    .btn:hover{box-shadow:0 10px 24px rgba(124,150,255,.25)}
    .btn:active{transform: translateY(1px)}
    .btn.secondary{background:#12152a}
    .btn.ghost{background:transparent}
    .grid{display:grid; grid-template-columns: repeat(auto-fit, minmax(220px,1fr)); gap:14px}
    .opt{display:flex; align-items:center; gap:10px; padding:12px; background:#101327; border:1px solid var(--border); border-radius:12px}
    .opt input[type="checkbox"]{width:18px; height:18px}
    label span.small{color:var(--muted); font-size:.92rem}
    .range{
      background:#101327; border:1px solid var(--border); padding:12px; border-radius:12px; display:grid; gap:6px
    }
    input[type="range"]{width:100%}
    .strength{display:grid; gap:8px}
    .bar{height:10px; background:#0b0e1a; border:1px solid var(--border); border-radius:999px; overflow:hidden}
    .bar > i{display:block; height:100%; width:0%}
    .note{color:var(--muted); font-size:.95rem}
    .pill{display:inline-block; padding:6px 10px; border:1px solid var(--border); border-radius:999px; font-weight:600}
    .row-actions{display:flex; gap:10px; flex-wrap:wrap; justify-self:end}
    footer{color:var(--muted); font-size:.9rem; text-align:center; margin-top:4px}
    .warn{color:var(--danger)}
    @media (max-width:560px){ .row{grid-template-columns: 1fr}; .row-actions{justify-self:stretch}}
  </style>
</head>
<body>
  <main class="app" role="main">
    <header>
      <h1>🔐 Générateur de mot de passe</h1>
      <p>Génère des mots de passe robustes localement. Aucune donnée n’est transmise.</p>
    </header>

    <section class="card">
      <div class="row">
        <output id="password" class="out" aria-live="polite" title="Mot de passe généré">Clique sur « Générer »</output>
        <div class="row-actions">
          <button class="btn" id="btn-generate">Générer</button>
          <button class="btn secondary" id="btn-copy" disabled>Copier</button>
        </div>
      </div>
    </section>

    <section class="card grid" aria-labelledby="opts-title">
      <h2 id="opts-title" style="margin:0 0 -6px 0; grid-column:1/-1; font-size:1.05rem; color:var(--muted)">Options</h2>

      <div class="range">
        <div class="row" style="grid-template-columns:auto 1fr auto">
          <label for="length"><strong>Longueur</strong></label>
          <input id="length" type="range" min="8" max="64" value="16" />
          <span><span id="len-val" class="pill">16</span></span>
        </div>
        <div class="note">Recommandé : 16+ pour comptes sensibles, 24–32 pour coffres/administration.</div>
      </div>

      <label class="opt"><input type="checkbox" id="use-lower" checked /> Lettres minuscules (a–z)</label>
      <label class="opt"><input type="checkbox" id="use-upper" checked /> Lettres majuscules (A–Z)</label>
      <label class="opt"><input type="checkbox" id="use-digits" checked /> Chiffres (0–9)</label>
      <label class="opt"><input type="checkbox" id="use-symbols" /> Symboles (!@#$…)</label>

      <label class="opt"><input type="checkbox" id="avoid-ambig" checked /> Éviter les caractères ambigus (O/0, l/1, etc.)</label>
      <label class="opt"><input type="checkbox" id="ensure-each" checked /> Garantir au moins un caractère de chaque type choisi</label>
      <label class="opt"><input type="checkbox" id="no-repeats" /> Interdire les répétitions immédiates (aa, 11, …)</label>
      <label class="opt"><input type="checkbox" id="readable" /> Lisible (insère des séparateurs)</label>
    </section>

    <section class="card strength" aria-labelledby="strength-title">
      <div class="row" style="grid-template-columns:auto auto 1fr">
        <h2 id="strength-title" style="margin:0; font-size:1.05rem; color:var(--muted)">Robustesse</h2>
        <span id="entropy" class="pill" title="Entropie estimée en bits">– bits</span>
        <div style="justify-self:end"><span id="label" class="pill">—</span></div>
      </div>
      <div class="bar"><i id="bar-fill"></i></div>
      <div class="note">
        Estimation basée sur l’entropie <em>H ≈ log2(N^L)</em> (alphabet N, longueur L), ajustée si « au moins un de chaque » est imposé.
        Plus c’est grand, mieux c’est. Vise 80–100+ bits pour du long terme.
      </div>
    </section>

    <footer>
      <p>💡 Astuce : utilise un gestionnaire de mots de passe et active la 2FA. |
         <span class="warn">Ne recycle jamais</span> tes mots de passe. |
         <a href="/privacy.html" style="color:inherit">Confidentialité</a>
      </p>
    </footer>
  </main>

  <script>
    // --- Charsets (avec et sans caractères ambigus) ---
    const sets = {
      lower: 'abcdefghijklmnopqrstuvwxyz',
      upper: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ',
      digits: '0123456789',
      symbols: '!@#$%^&*()-_=+[]{};:,.?/|~'
    };
    const ambiguous = new Set('O0oIl1|`\'"“”‘’[]{}()<>.,');

    const el = (id) => document.getElementById(id);
    const out = el('password');
    const copyBtn = el('btn-copy');
    const genBtn  = el('btn-generate');
    const lenRange = el('length');
    const lenVal = el('len-val');

    const chk = {
      lower: el('use-lower'),
      upper: el('use-upper'),
      digits: el('use-digits'),
      symbols: el('use-symbols'),
      ambig: el('avoid-ambig'),
      ensure: el('ensure-each'),
      norep: el('no-repeats'),
      readable: el('readable')
    };

    const entropyEl = el('entropy');
    const labelEl = el('label');
    const barFill = el('bar-fill');

    function cryptoRandInt(maxExclusive){
      if (maxExclusive <= 0) return 0;
      const array = new Uint32Array(1);
      const limit = Math.floor(0xFFFFFFFF / maxExclusive) * maxExclusive;
      while (true){
        crypto.getRandomValues(array);
        const x = array[0];
        if (x < limit) return x % maxExclusive;
      }
    }
    function buildAlphabet(){
      let chars = '';
      if (chk.lower.checked) chars += sets.lower;
      if (chk.upper.checked) chars += sets.upper;
      if (chk.digits.checked) chars += sets.digits;
      if (chk.symbols.checked) chars += sets.symbols;
      if (chk.ambig.checked){
        chars = [...chars].filter(c => !ambiguous.has(c)).join('');
      }
      return chars;
    }
    function pickFrom(str){ return str[cryptoRandInt(str.length)] }

    function generate(){
      const L = parseInt(lenRange.value, 10);
      let alpha = buildAlphabet();
      if (!alpha){ alert('Sélectionne au moins un type de caractères.'); return; }

      const sep = chk.readable.checked ? '-' : '';
      const groupSize = 4;
      let pwd = '';

      const pools = [];
      if (chk.ensure.checked){
        if (chk.lower.checked) pools.push(sets.lower);
        if (chk.upper.checked) pools.push(sets.upper);
        if (chk.digits.checked) pools.push(sets.digits);
        if (chk.symbols.checked) pools.push(sets.symbols);
      }

      let required = '';
      for (const p of pools){
        let candidate = p;
        if (chk.ambig.checked) candidate = [...p].filter(c => !ambiguous.has(c)).join('');
        if (candidate.length) required += pickFrom(candidate);
      }

      let remaining = Math.max(0, L - required.length);
      let core = required;
      for (let i = 0; i < remaining; i++){
        let c;
        do {
          c = pickFrom(alpha);
        } while (chk.norep.checked && core.length && c === core.at(-1));
        core += c;
      }

      let arr = core.split('');
      for (let i = arr.length - 1; i > 0; i--){
        const j = cryptoRandInt(i + 1);
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }

      if (chk.readable.checked){
        const groups = [];
        for (let i = 0; i < arr.length; i += groupSize) groups.push(arr.slice(i, i+groupSize).join(''));
        pwd = groups.join(sep);
      } else {
        pwd = arr.join('');
      }

      out.textContent = pwd;
      copyBtn.disabled = !pwd;
      updateStrength(alpha.length, L, chk.ensure.checked ? pools.length : 0);
    }

    function updateStrength(N, L, k){
      const log2 = (x) => Math.log(x) / Math.log(2);
      let H = L * log2(Math.max(2, N));
      if (k >= 2 && L > k){
        H -= (k - 1) * log2(L);
      }
      const bits = Math.max(0, Math.round(H));
      entropyEl.textContent = bits + ' bits';

      let label = 'Faible';
      if (bits >= 80) label = 'Fort';
      if (bits >= 100) label = 'Très fort';
      if (bits >= 128) label = 'Extrême';
      labelEl.textContent = label;
      barFill.style.width = Math.min(100, (bits / 128) * 100) + '%';
      barFill.style.background = bits < 60 ? 'linear-gradient(90deg, #ff5d7a, #ff996a)' :
                                 bits < 90 ? 'linear-gradient(90deg, #ffb86c, #ffd56a)' :
                                 bits < 120 ? 'linear-gradient(90deg, #7cffa1, #41e8c1)' :
                                              'linear-gradient(90deg, #7c96ff, #41e8c1)';
    }

    genBtn.addEventListener('click', generate);
    copyBtn.addEventListener('click', async () => {
      const text = out.textContent.trim();
      if (!text) return;
      try{
        await navigator.clipboard.writeText(text);
        copyBtn.textContent = 'Copié ✔';
        setTimeout(()=> copyBtn.textContent = 'Copier', 1200);
      }catch{
        const ta = document.createElement('textarea');
        ta.value = text; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove();
      }
    });
    lenRange.addEventListener('input', () => { lenVal.textContent = lenRange.value });
    window.addEventListener('DOMContentLoaded', generate);
  </script>
</body>
</html>
